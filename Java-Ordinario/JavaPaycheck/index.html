<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="index.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pasarela de Pagos - PayPal Sandbox</title>
</head>
<body>
<div class="payment-container">
    <div class="header">
        <h1>Pasarela de Pagos</h1>
        <p>Procesamiento seguro con PayPal Sandbox</p>
    </div>

    <div class="product-info">
        <div class="product-name">Producto Demo</div>
        <div class="product-description">Descripci√≥n del producto o servicio</div>

    </div>

    <div class="payment-methods">
        <h3>Selecciona tu m√©todo de pago:</h3>

        <button class="payment-button paypal-button" onclick="processPayPalPayment()">
            <span>üÖøÔ∏è</span>
            Pagar con PayPal
        </button>

        <button class="payment-button card-button" onclick="processCardPayment()">
            <span>üí≥</span>
            Pagar con Tarjeta
        </button>
    </div>

    <div id="status-message" class="status-message"></div>

    <div class="sandbox-info">
        <h4>üß™ Informaci√≥n del Sandbox</h4>
        <p><strong>Entorno de prueba:</strong> Esta es una implementaci√≥n de demostraci√≥n</p>
        <p><strong>Datos de prueba PayPal:</strong></p>
        <div class="credentials">
            Email: sb-buyer@example.com<br>
            Password: testpassword123
        </div>
        <p><strong>Tarjeta de prueba:</strong></p>
        <div class="credentials">
            N√∫mero: 4111 1111 1111 1111<br>
            Exp: 12/25 | CVV: 123
        </div>
    </div>
</div>

<!-- falta un sdk de paypal -->
<script>
    // Configuraci√≥n de la pasarela
    const PAYMENT_CONFIG = {
        amount: '25.00',
        currency: 'USD',
        description: 'Producto Demo',
        sandbox: true
    };

    // Funci√≥n para mostrar mensajes de estado
    function showMessage(message, type) {
        const statusDiv = document.getElementById('status-message');
        statusDiv.textContent = message;
        statusDiv.className = `status-message ${type}`;
        statusDiv.style.display = 'block';

        if (type === 'success' || type === 'error') {
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }
    }

    // Procesar pago con PayPal
    function processPayPalPayment() {
        showMessage('Inicializando PayPal...', 'loading');

        // Crear bot√≥n de PayPal din√°micamente
        const paypalContainer = document.createElement('div');
        paypalContainer.id = 'paypal-button-container';

        // Reemplazar el bot√≥n actual
        const paypalButton = document.querySelector('.paypal-button');
        paypalButton.parentNode.replaceChild(paypalContainer, paypalButton);

        paypal.Buttons({
            createOrder: function(data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: PAYMENT_CONFIG.amount,
                            currency_code: PAYMENT_CONFIG.currency
                        },
                        description: PAYMENT_CONFIG.description
                    }]
                });
            },
            onApprove: function(data, actions) {
                showMessage('Procesando pago...', 'loading');

                return actions.order.capture().then(function(details) {
                    console.log('Pago completado:', details);
                    showMessage(
                        `‚úÖ ¬°Pago exitoso! ID de transacci√≥n: ${details.id}`,
                        'success'
                    );

                    // Aqu√≠ puedes agregar l√≥gica adicional como redirecci√≥n
                    setTimeout(() => {
                        alert('Pago procesado correctamente. Gracias por tu compra!');
                    }, 2000);
                });
            },
            onError: function(err) {
                console.error('Error en el pago:', err);
                showMessage('‚ùå Error al procesar el pago. Intenta nuevamente.', 'error');
            },
            onCancel: function(data) {
                showMessage('‚ö†Ô∏è Pago cancelado por el usuario.', 'error');
                // Restaurar bot√≥n original
                location.reload();
            }
        }).render('#paypal-button-container');

        document.getElementById('status-message').style.display = 'none';
    }

    // Simulaci√≥n de pago con tarjeta
    function processCardPayment() {
        showMessage('Procesando pago con tarjeta...', 'loading');

        // Simulaci√≥n de procesamiento
        setTimeout(() => {
            // Simulaci√≥n de √©xito/error aleatorio
            const success = Math.random() > 0.3; // 70% de √©xito

            if (success) {
                const transactionId = 'TXN_' + Math.random().toString(36).substr(2, 9).toUpperCase();
                showMessage(
                    `‚úÖ ¬°Pago con tarjeta exitoso! ID: ${transactionId}`,
                    'success'
                );

                setTimeout(() => {
                    alert('Pago procesado correctamente. Gracias por tu compra!');
                }, 2000);
            } else {
                showMessage('‚ùå Error al procesar la tarjeta. Verifica tus datos.', 'error');
            }
        }, 2000);
    }

    // Funci√≥n para simular webhook (en producci√≥n esto ser√≠a server-side)
    function simulateWebhook(transactionData) {
        console.log('Webhook simulado:', transactionData);

        // Aqu√≠ enviar√≠as los datos a tu servidor
        // fetch('/webhook/payment', {
        //     method: 'POST',
        //     headers: { 'Content-Type': 'application/json' },
        //     body: JSON.stringify(transactionData)
        // });
    }

    // Log de configuraci√≥n para debugging
    console.log('Pasarela de pagos inicializada:', PAYMENT_CONFIG);
    console.log('Modo Sandbox:', PAYMENT_CONFIG.sandbox ? 'Activado' : 'Desactivado');
</script>
</body>
</html>